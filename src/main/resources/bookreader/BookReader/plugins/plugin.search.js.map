{"version":3,"file":"plugins/plugin.search.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./node_modules/core-js/internals/string-trim-forced.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.trim.js","webpack://@internetarchive/bookreader/./src/BookReaderPlugin.js","webpack://@internetarchive/bookreader/./src/plugins/search/view.js","webpack://@internetarchive/bookreader/./src/plugins/search/utils.js","webpack://@internetarchive/bookreader/./src/plugins/search/plugin.search.js","webpack://@internetarchive/bookreader/./src/util/strings.js"],"sourcesContent":["'use strict';\nvar PROPER_FUNCTION_NAME = require('../internals/function-name').PROPER;\nvar fails = require('../internals/fails');\nvar whitespaces = require('../internals/whitespaces');\n\nvar non = '\\u200B\\u0085\\u180E';\n\n// check that a method works with the correct list\n// of whitespaces and has a correct name\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    return !!whitespaces[METHOD_NAME]()\n      || non[METHOD_NAME]() !== non\n      || (PROPER_FUNCTION_NAME && whitespaces[METHOD_NAME].name !== METHOD_NAME);\n  });\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $trim = require('../internals/string-trim').trim;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\n// `String.prototype.trim` method\n// https://tc39.es/ecma262/#sec-string.prototype.trim\n$({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {\n  trim: function trim() {\n    return $trim(this);\n  }\n});\n","// @ts-check\r\n/** @typedef {import(\"./BookReader.js\").default} BookReader */\r\n\r\n/**\r\n * @template TOptions\r\n */\r\nexport class BookReaderPlugin {\r\n  /**\r\n   * @param {BookReader} br\r\n   */\r\n  constructor(br) {\r\n    /** @type {BookReader} */\r\n    this.br = br;\r\n    /** @type {TOptions} */\r\n    this.options;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {TOptions} options\r\n   **/\r\n  setup(options) {\r\n    this.options = Object.assign({}, this.options, options);\r\n  }\r\n\r\n  /** @abstract */\r\n  init() {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {import (\"./BookReader/PageContainer.js\").PageContainer} pageContainer\r\n   */\r\n  _configurePageContainer(pageContainer) {\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {JQuery<HTMLElement>} $toolbarElement\r\n   */\r\n  _configureToolbar($toolbarElement) {\r\n  }\r\n\r\n  /** @abstract @protected */\r\n  _bindNavigationHandlers() {}\r\n\r\n  /**\r\n   * @param {JQuery<HTMLElement>} $navBar\r\n   */\r\n  extendNavBar($navBar) {}\r\n}\r\n","// @ts-check\r\n/** @typedef {import('@/src/BookReader.js').default} BookReader */\r\n\r\nclass SearchView {\r\n  /**\r\n   * @param {object} params\r\n   * @param {BookReader} params.br The BookReader instance\r\n   * @param {function} params.searchCancelledCallback callback when a user wants to cancel search\r\n   *\r\n   * @event BookReader:SearchResultsCleared - when the search results nav gets cleared\r\n   * @event BookReader:ToggleSearchMenu - when search results menu should toggle\r\n   */\r\n  constructor({ br, searchCancelledCallback = () => {} }) {\r\n    /** @type {BookReader} */\r\n    this.br = br;\r\n    this.matches = [];\r\n    this.cacheDOMElements();\r\n    this.cancelSearch = searchCancelledCallback;\r\n  }\r\n\r\n  init() {\r\n    this.bindEvents();\r\n  }\r\n\r\n  cacheDOMElements() {\r\n    this.dom = {};\r\n    // Search input within the top toolbar. Will be removed once the mobile menu is replaced.\r\n    this.dom.toolbarSearch = this.buildToolbarSearch();\r\n  }\r\n\r\n  /**\r\n   * @param {string} query\r\n   */\r\n  setQuery(query) {\r\n    this.br.$('[name=\"query\"]').val(query);\r\n  }\r\n\r\n  emptyMatches() {\r\n    this.matches = [];\r\n  }\r\n\r\n  removeResultPins() {\r\n    this.br.$('.BRnavpos .BRsearch').remove();\r\n  }\r\n\r\n  clearSearchFieldAndResults(dispatchEventWhenComplete = true) {\r\n    this.br.plugins.search.removeSearchResults();\r\n    this.removeResultPins();\r\n    this.emptyMatches();\r\n    this.setQuery('');\r\n    this.teardownSearchNavigation();\r\n    if (dispatchEventWhenComplete) {\r\n      this.br.trigger('SearchResultsCleared');\r\n    }\r\n  }\r\n\r\n  toggleSidebar() {\r\n    this.br.trigger('ToggleSearchMenu');\r\n  }\r\n\r\n  renderSearchNavigation() {\r\n    const selector = 'BRsearch-navigation';\r\n    $('.BRnav').before(`\r\n      <div class=\"${selector}\">\r\n        <button class=\"toggle-sidebar\">\r\n          <h4>\r\n            <span class=\"icon icon-search\"></span> Results\r\n          </h4>\r\n        </button>\r\n        <div class=\"pagination\">\r\n          <button class=\"prev\" title=\"Previous result\"><span class=\"icon icon-chevron hflip\"></span></button>\r\n          <span data-id=\"resultsCount\">${this.resultsPosition()}</span>\r\n          <button class=\"next\" title=\"Next result\"><span class=\"icon icon-chevron\"></button>\r\n        </div>\r\n        <button class=\"clear\" title=\"Clear search results\">\r\n          <span class=\"icon icon-close\"></span>\r\n        </button>\r\n      </div>\r\n    `);\r\n    this.dom.searchNavigation = $(`.${selector}`);\r\n  }\r\n\r\n  resultsPosition() {\r\n    let positionMessage = `${this.matches.length} result${this.matches.length === 1 ? '' : 's'}`;\r\n    if (~this.currentMatchIndex) {\r\n      positionMessage = `${this.currentMatchIndex + 1} / ${this.matches.length}`;\r\n    }\r\n    return positionMessage;\r\n  }\r\n\r\n  bindSearchNavigationEvents() {\r\n    if (!this.dom.searchNavigation) { return; }\r\n    const namespace = 'searchNavigation';\r\n\r\n    this.dom.searchNavigation\r\n      .on(`click.${namespace}`, '.clear', this.clearSearchFieldAndResults.bind(this))\r\n      .on(`click.${namespace}`, '.prev', this.showPrevResult.bind(this))\r\n      .on(`click.${namespace}`, '.next', this.showNextResult.bind(this))\r\n      .on(`click.${namespace}`, '.toggle-sidebar', this.toggleSidebar.bind(this))\r\n      .on(`click.${namespace}`, false);\r\n  }\r\n\r\n  showPrevResult() {\r\n    if (this.currentMatchIndex === 0) { return; }\r\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\r\n    if (!~this.currentMatchIndex) {\r\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => end[0] > comparator) + 1;\r\n    }\r\n    this.br.$('.BRnavline .BRsearch').eq(--this.currentMatchIndex).click();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  showNextResult() {\r\n    if (this.currentMatchIndex + 1 === this.matches.length) { return; }\r\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\r\n    if (!~this.currentMatchIndex) {\r\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => start[start.length - 1] > comparator) - 1;\r\n    }\r\n    this.br.$('.BRnavline .BRsearch').eq(++this.currentMatchIndex).click();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  /**\r\n   * Obtains closest match based on the logical comparison function passed in.\r\n   * When the comparison function returns true, the starting (left) half of the\r\n   * matches array is used in the binary split, else the ending (right) half is\r\n   * used. A recursive call is made to perform the same split and comparison\r\n   * on the winning half of the matches. This is traditionally known as binary\r\n   * search (https://en.wikipedia.org/wiki/Binary_search_algorithm), and in\r\n   * most cases (medium to large search result arrays) should outperform\r\n   * traversing the array from start to finish. In the case of small arrays,\r\n   * the speed difference is negligible.\r\n   *\r\n   * @param {function} comparisonFn\r\n   * @return {number} matchIndex\r\n   */\r\n  getClosestMatchIndex(comparisonFn) {\r\n    const matchPages = this.matches.map((m) => m.par[0].page);\r\n    const currentPage = this.br.currentIndex() + 1;\r\n    const closestTo = (pool, comparator) => {\r\n      if (pool.length === 1) { return pool[0]; }\r\n      const start = pool.slice(0, pool.length / 2);\r\n      const end = pool.slice(pool.length / 2);\r\n      return closestTo((comparisonFn(start, end, comparator) ? start : end), comparator);\r\n    };\r\n\r\n    const closestPage = closestTo(matchPages, currentPage);\r\n    return this.matches.indexOf(this.matches.find((m) => m.par[0].page === closestPage));\r\n  }\r\n\r\n  updateResultsPosition() {\r\n    if (!this.dom.searchNavigation) return;\r\n    this.dom.searchNavigation.find('[data-id=resultsCount]').text(this.resultsPosition());\r\n  }\r\n\r\n  updateSearchNavigationButtons() {\r\n    if (!this.dom.searchNavigation) return;\r\n    this.dom.searchNavigation.find('.prev').attr('disabled', !this.currentMatchIndex);\r\n    this.dom.searchNavigation.find('.next').attr('disabled', this.currentMatchIndex + 1 === this.matches.length);\r\n  }\r\n\r\n  teardownSearchNavigation() {\r\n    if (!this.dom.searchNavigation) {\r\n      this.dom.searchNavigation = $('.BRsearch-navigation');\r\n    }\r\n    if (!this.dom.searchNavigation.length) { return; }\r\n\r\n    this.dom.searchNavigation.off('.searchNavigation').remove();\r\n    this.dom.searchNavigation = null;\r\n    this.br.resize();\r\n  }\r\n\r\n  setCurrentMatchIndex() {\r\n    let matchingSearchResult;\r\n    if (this.br.mode === this.br.constModeThumb) {\r\n      this.currentMatchIndex = -1;\r\n      return;\r\n    }\r\n    if (this.br.mode === this.br.constMode2up) {\r\n      matchingSearchResult = this.find2upMatchingSearchResult();\r\n    }\r\n    else {\r\n      matchingSearchResult = this.find1upMatchingSearchResult();\r\n    }\r\n    this.currentMatchIndex = this.matches.indexOf(matchingSearchResult);\r\n  }\r\n\r\n  find1upMatchingSearchResult() {\r\n    return this.matches.find((m) => this.br.currentIndex() === m.par[0].page - 1);\r\n  }\r\n\r\n  find2upMatchingSearchResult() {\r\n    return this.matches.find((m) => this.br._isIndexDisplayed(m.par[0].page - 1));\r\n  }\r\n\r\n  updateSearchNavigation() {\r\n    if (!this.matches.length) { return; }\r\n\r\n    this.setCurrentMatchIndex();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  /**\r\n   * @param {boolean} bool\r\n   */\r\n  togglePinsFor(bool) {\r\n    const pinsVisibleState = bool ? 'visible' : 'hidden';\r\n    this.br.refs.$BRfooter.find('.BRsearch').css({ visibility: pinsVisibleState });\r\n  }\r\n\r\n  buildToolbarSearch() {\r\n    const toolbarSearch = document.createElement('span');\r\n    toolbarSearch.classList.add('BRtoolbarSection', 'BRtoolbarSectionSearch');\r\n    toolbarSearch.innerHTML = `\r\n      <form class=\"BRbooksearch desktop\">\r\n        <input type=\"search\" name=\"query\" class=\"BRsearchInput\" value=\"\" placeholder=\"Search inside\"/>\r\n        <button type=\"submit\" class=\"BRsearchSubmit\">\r\n          <img src=\"${this.br.options.imagesBaseURL}icon_search_button.svg\" />\r\n        </button>\r\n      </form>\r\n    `;\r\n    return toolbarSearch;\r\n  }\r\n\r\n  /**\r\n   * @param {array} matches\r\n   */\r\n  renderPins(matches) {\r\n    matches.forEach((match) => {\r\n      const pageIndex = this.br.book.leafNumToIndex(match.par[0].page);\r\n      const uiStringSearch = \"Search result\"; // i18n\r\n      const percentThrough = this.br.constructor.util.cssPercentage(pageIndex, this.br.book.getNumLeafs() - 1);\r\n\r\n      let html = match.html;\r\n      if (html.length > 200) {\r\n        const start = Math.max(0, html.indexOf('<mark>') - 100);\r\n        if (start != 0) {\r\n          html = 'â€¦' + match.html\r\n            .substring(start)\r\n            // Make sure at word boundary though\r\n            .replace(/^\\S+/, '');\r\n        }\r\n      }\r\n      // draw marker\r\n      $('<div>')\r\n        .addClass('BRsearch')\r\n        .css({\r\n          left: percentThrough,\r\n        })\r\n        .attr('title', uiStringSearch)\r\n        .append(`\r\n          <div class=\"BRquery\">\r\n            <main>${html}</main>\r\n            <footer>Page ${match.displayPageNumber}</footer>\r\n          </div>\r\n        `)\r\n        .appendTo(this.br.$('.BRnavline'))\r\n        .on(\"mouseenter\", (event) => {\r\n          // remove from other markers then turn on just for this\r\n          // XXX should be done when nav slider moves\r\n          const marker = event.currentTarget;\r\n          const tooltip = marker.querySelector('.BRquery');\r\n          const tooltipOffset = tooltip.getBoundingClientRect();\r\n          const targetOffset = marker.getBoundingClientRect();\r\n          const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\r\n          if (tooltipOffset.x - boxSizeAdjust < 0) {\r\n            tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\r\n          }\r\n          $('.BRsearch,.BRchapter').removeClass('front');\r\n          $(event.target).addClass('front');\r\n        })\r\n        .on(\"mouseleave\", (event) => $(event.target).removeClass('front'))\r\n        .on(\"click\", () => { this.br.plugins.search.jumpToMatch(match.matchIndex); });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {boolean} show\r\n   */\r\n  toggleSearchPending(show = false) {\r\n    if (show) {\r\n      this.br.showProgressPopup(\"Search results will appear below...\", () => this.progressPopupClosed());\r\n    }\r\n    else {\r\n      this.br.removeProgressPopup();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Primary callback when user cancels search popup\r\n   */\r\n  progressPopupClosed() {\r\n    this.toggleSearchPending();\r\n    this.cancelSearch();\r\n  }\r\n\r\n  renderErrorModal(textIsProcessing = false) {\r\n    const errorDetails = `${!textIsProcessing ? 'The text may still be processing. ' : ''}Please try again.`;\r\n    this.renderModalMessage(`\r\n      Sorry, there was an error with your search.\r\n      <br />\r\n      ${errorDetails}\r\n    `);\r\n    this.delayModalRemovalFor(4000);\r\n  }\r\n\r\n  renderBookNotIndexedModal() {\r\n    this.renderModalMessage(`\r\n      <p>\r\n         This book hasn't been indexed for searching yet.\r\n         We've just started indexing it, so search should be available soon.\r\n         <br />\r\n         Please try again later. Thanks!\r\n      </p>\r\n    `);\r\n    this.delayModalRemovalFor(5000);\r\n  }\r\n\r\n  renderResultsEmptyModal() {\r\n    this.renderModalMessage('No matches were found.');\r\n    this.delayModalRemovalFor(2000);\r\n  }\r\n\r\n  /**\r\n   * @param {string} messageHTML The innerHTML string used to popupate the modal contents\r\n   */\r\n  renderModalMessage(messageHTML) {\r\n    const modal = document.createElement('div');\r\n    modal.classList.add('BRprogresspopup', 'search_modal');\r\n    modal.innerHTML = messageHTML;\r\n    document.querySelector(this.br.el).append(modal);\r\n  }\r\n\r\n  /**\r\n   * @param {number} timeoutMS\r\n   */\r\n  delayModalRemovalFor(timeoutMS) {\r\n    setTimeout(this.br.removeProgressPopup.bind(this.br), timeoutMS);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} e\r\n   */\r\n  submitHandler(e) {\r\n    e.preventDefault();\r\n    const query = e.target.querySelector('[name=\"query\"]').value;\r\n    if (!query.length) { return false; }\r\n    this.br.search(query);\r\n    this.emptyMatches();\r\n    this.toggleSearchPending(true);\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} e\r\n   * @param {object} properties\r\n   *   @param {object} properties.results\r\n   *   @param {object} properties.options\r\n   */\r\n  handleSearchCallback(e, { results, options }) {\r\n    this.matches = results.matches;\r\n    this.setCurrentMatchIndex();\r\n    this.teardownSearchNavigation();\r\n    this.renderSearchNavigation();\r\n    this.bindSearchNavigationEvents();\r\n    this.renderPins(results.matches);\r\n    this.toggleSearchPending(false);\r\n    if (options.goToFirstResult) {\r\n      $(document).one('BookReader:pageChanged', () => {\r\n        this.br.resize();\r\n      });\r\n    } else {\r\n      this.br.resize();\r\n    }\r\n  }\r\n\r\n  handleSearchStarted() {\r\n    this.emptyMatches();\r\n    this.br.plugins.search.removeSearchHilites();\r\n    this.removeResultPins();\r\n    this.toggleSearchPending(true);\r\n    this.teardownSearchNavigation();\r\n    this.setQuery(this.br.plugins.search.searchTerm);\r\n  }\r\n\r\n  /**\r\n   * Event listener for: `BookReader:SearchCallbackError`\r\n   * @param {CustomEvent} event\r\n   */\r\n  handleSearchCallbackError(event = {}) {\r\n    this.toggleSearchPending(false);\r\n    const isIndexed = event?.detail?.props?.results?.indexed;\r\n    this.renderErrorModal(isIndexed);\r\n  }\r\n\r\n  handleSearchCallbackBookNotIndexed() {\r\n    this.toggleSearchPending(false);\r\n    this.renderBookNotIndexedModal();\r\n  }\r\n\r\n  handleSearchCallbackEmpty() {\r\n    this.toggleSearchPending(false);\r\n    this.renderResultsEmptyModal();\r\n  }\r\n\r\n  bindEvents() {\r\n    const namespace = 'BookReader:';\r\n\r\n    window.addEventListener(`${namespace}SearchCallbackError`, this.handleSearchCallbackError.bind(this));\r\n    $(document).on(`${namespace}SearchCallback`, this.handleSearchCallback.bind(this))\r\n      .on(`${namespace}SearchStarted`, this.handleSearchStarted.bind(this))\r\n      .on(`${namespace}SearchCallbackBookNotIndexed`, this.handleSearchCallbackBookNotIndexed.bind(this))\r\n      .on(`${namespace}SearchCallbackEmpty`, this.handleSearchCallbackEmpty.bind(this))\r\n      .on(`${namespace}pageChanged`, this.updateSearchNavigation.bind(this));\r\n\r\n    this.dom.toolbarSearch.querySelector('form').addEventListener('submit', this.submitHandler.bind(this));\r\n  }\r\n}\r\n\r\nexport default SearchView;\r\n","import { escapeHTML, escapeRegExp } from '../../BookReader/utils.js';\r\n\r\n/**\r\n * @param {string} match\r\n * @param {string} preTag\r\n * @param {string} postTag\r\n * @returns {string}\r\n */\r\nexport function renderMatch(match, preTag, postTag) {\r\n  // Search results are returned as a text blob with the hits wrapped in\r\n  // triple mustaches. Hits occasionally include text beyond the search\r\n  // term, so everything within the staches is captured and wrapped.\r\n  const preTagRe = escapeRegExp(escapeHTML(preTag));\r\n  const postTagRe = escapeRegExp(escapeHTML(postTag));\r\n  // [^] matches any character, including line breaks\r\n  const regex = new RegExp(`${preTagRe}([^]+?)${postTagRe}`, 'g');\r\n  return escapeHTML(match)\r\n    .replace(regex, '<mark>$1</mark>')\r\n    // Fix trailing hyphens. This over-corrects but is net useful.\r\n    .replace(/(\\b)- /g, '$1');\r\n}\r\n\r\n/**\r\n * Attach some fields to search inside results\r\n * @param {SearchInsideResults} results\r\n * @param {(pageNum: LeafNum) => PageNumString} displayPageNumberFn\r\n * @param {string} preTag\r\n * @param {string} postTag\r\n */\r\nexport function marshallSearchResults(results, displayPageNumberFn, preTag, postTag) {\r\n  // Attach matchIndex to a few things to make it easier to identify\r\n  // an active/selected match\r\n  for (const [index, match] of results.matches.entries()) {\r\n    match.matchIndex = index;\r\n    match.displayPageNumber = displayPageNumberFn(match.par[0].page);\r\n    match.html = renderMatch(match.text, preTag, postTag);\r\n    for (const par of match.par) {\r\n      for (const box of par.boxes) {\r\n        box.matchIndex = index;\r\n      }\r\n    }\r\n  }\r\n}\r\n","// @ts-check\r\n/**\r\n * Plugin for Archive.org book search\r\n * Events fired at various points throughout search processing are published\r\n * on the document DOM element. These can be subscribed to using jQuery's event\r\n * binding method `$.fn.on`. All of the events are prefixed with a BookReader\r\n * namespace. The events are:\r\n *\r\n * @event BookReader:SearchStarted - When a search form is submitted, immediately\r\n *   before an AJAX call is made to request search results\r\n * @event BookReader:SearchCallback - When the search AJAX call is returned and at\r\n *   least one result is returned. The event callback receives an object\r\n *   with the `results`, plugin `options`, and the BookReader `instance`\r\n * @event BookReader:SearchCallbackError - When the AJAX request returns an error.\r\n *   Receives the `results` and `instance`\r\n * @event BookReader:SearchCallbackNotIndexed - When a message is received that\r\n *   the book has not had OCR text indexed yet. Receives `instance`\r\n * @event BookReader:SearchCallbackEmpty - When no results found. Receives\r\n *   `instance`\r\n * @event BookReader:SearchCanceled - When no results found. Receives\r\n *   `instance`\r\n */\r\nimport { poll } from '../../BookReader/utils.js';\r\nimport { renderBoxesInPageContainerLayer } from '../../BookReader/PageContainer.js';\r\nimport SearchView from './view.js';\r\nimport { marshallSearchResults } from './utils.js';\r\nimport { BookReaderPlugin } from '../../BookReaderPlugin.js';\r\nimport { applyVariables } from '../../util/strings.js';\r\n/** @typedef {import('../../BookReader/PageContainer').PageContainer} PageContainer */\r\n/** @typedef {import('../../BookReader/BookModel').PageIndex} PageIndex */\r\n/** @typedef {import('../../BookReader/BookModel').LeafNum} LeafNum */\r\n/** @typedef {import('../../BookReader/BookModel').PageNumString} PageNumString */\r\n\r\n// @ts-ignore\r\nconst BookReader = /** @type {typeof import('@/src/BookReader.js').default} */(window.BookReader);\r\n\r\nexport class SearchPlugin extends BookReaderPlugin {\r\n  options = {\r\n    enabled: true,\r\n    preTag: '{{{',\r\n    postTag: '}}}',\r\n    /**\r\n     * @type {import('@/src/util/strings.js').StringWithVars}\r\n     * Provides the variables: `query`, `preTag`, and `postTag` (from these options)\r\n     */\r\n    searchInsideUrl: '/fulltext/inside.php?' + [\r\n      'q={{query|urlencode}}',\r\n      'pre_tag={{preTag|urlencode}}',\r\n      'post_tag={{postTag|urlencode}}',\r\n    ].join('&'),\r\n    /** @type {string} */\r\n    initialSearchTerm: null,\r\n    goToFirstResult: false,\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {Partial<SearchPlugin['options']>} options\r\n   **/\r\n  setup(options) {\r\n    super.setup(options);\r\n\r\n    this.searchTerm = '';\r\n    /** @type {SearchInsideResults | null} */\r\n    this.searchResults = null;\r\n    this.searchInsideUrl = this.options.searchInsideUrl;\r\n    this.enabled = this.options.enabled;\r\n    this.searchXHR = null;\r\n\r\n    /** @type { {[pageIndex: number]: SearchInsideMatchBox[]} } */\r\n    this._searchBoxesByIndex = {};\r\n\r\n    if (this.enabled) {\r\n      this.searchView = new SearchView({\r\n        br: this.br,\r\n        searchCancelledCallback: () => {\r\n          this._cancelSearch();\r\n          this.br.trigger('SearchCanceled', { term: this.searchTerm, instance: this.br });\r\n        },\r\n      });\r\n    } else {\r\n      this.searchView = null;\r\n    }\r\n  }\r\n\r\n  /** @override */\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.enabled) return;\r\n\r\n    this.searchView.init();\r\n    if (this.options.initialSearchTerm) {\r\n      /**\r\n       * this.search() take two parameter\r\n       * 1. this.options.initialSearchTerm - search term\r\n       * 2. {\r\n       *  goToFirstResult: this.options.goToFirstResult,\r\n       *  suppressFragmentChange: false // always want to change fragment in URL\r\n       * }\r\n       */\r\n      this.search(\r\n        this.options.initialSearchTerm,\r\n        { goToFirstResult: this.options.goToFirstResult, suppressFragmentChange: false },\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @protected\r\n   * @param {JQuery<HTMLElement>} $toolbarElement\r\n   */\r\n  _configureToolbar($toolbarElement) {\r\n    if (!this.enabled) { return; }\r\n    if (this.searchView.dom.toolbarSearch) {\r\n      $toolbarElement.find('.BRtoolbarSectionInfo').after(this.searchView.dom.toolbarSearch);\r\n    }\r\n    return $toolbarElement;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {import (\"@/src/BookReader/PageContainer.js\").PageContainer} pageContainer\r\n   */\r\n  _configurePageContainer(pageContainer) {\r\n    if (this.enabled && pageContainer.page && pageContainer.page.index in this._searchBoxesByIndex) {\r\n      const pageIndex = pageContainer.page.index;\r\n      const boxes = this._searchBoxesByIndex[pageIndex];\r\n      renderBoxesInPageContainerLayer(\r\n        'searchHiliteLayer',\r\n        boxes,\r\n        pageContainer.page,\r\n        pageContainer.$container[0],\r\n        boxes.map(b => `match-index-${b.matchIndex}`),\r\n      );\r\n    }\r\n    return pageContainer;\r\n  }\r\n\r\n  /**\r\n   * Submits search request\r\n   *\r\n   * @param {string} term\r\n   * @param {Partial<SearchOptions>} overrides\r\n   */\r\n  async search(term = '', overrides = {}) {\r\n    /** @type {SearchOptions} */\r\n    const defaultOptions = {\r\n      goToFirstResult: false, /* jump to the first result (default=false) */\r\n      disablePopup: false,    /* don't show the modal progress (default=false) */\r\n      suppressFragmentChange: false, /* don't change the URL on initial load */\r\n      error: null,            /* optional error handler (default=null) */\r\n      success: null,          /* optional success handler (default=null) */\r\n\r\n    };\r\n    const options = jQuery.extend({}, defaultOptions, overrides);\r\n    this.suppressFragmentChange = options.suppressFragmentChange;\r\n    this.searchCancelled = false;\r\n\r\n    // strip slashes, since this goes in the url\r\n    this.searchTerm = term.replace(/\\//g, ' ');\r\n\r\n    if (!options.suppressFragmentChange) {\r\n      this.br.trigger(BookReader.eventNames.fragmentChange);\r\n    }\r\n\r\n    // Add quotes to the term. This is to compenstate for the backends default OR query\r\n    // term = term.replace(/['\"]+/g, '');\r\n    // term = '\"' + term + '\"';\r\n\r\n    const url = applyVariables(this.options.searchInsideUrl, this.br.options.vars, {\r\n      query: term,\r\n      preTag: this.options.preTag,\r\n      postTag: this.options.postTag,\r\n    });\r\n\r\n    const callSearchResultsCallback = (searchInsideResults) => {\r\n      if (this.searchCancelled) {\r\n        return;\r\n      }\r\n      const responseHasError = searchInsideResults.error || !searchInsideResults.matches.length;\r\n      const hasCustomError = typeof options.error === 'function';\r\n      const hasCustomSuccess = typeof options.success === 'function';\r\n\r\n      if (responseHasError) {\r\n        console.error('Search Inside Response Error', searchInsideResults.error || 'matches.length == 0');\r\n        hasCustomError\r\n          ? options.error.call(this, searchInsideResults, options)\r\n          : this.BRSearchCallbackError(searchInsideResults);\r\n      } else {\r\n        hasCustomSuccess\r\n          ? options.success.call(this, searchInsideResults, options)\r\n          : this.BRSearchCallback(searchInsideResults, options);\r\n      }\r\n    };\r\n\r\n    this.br.trigger('SearchStarted', { term: this.searchTerm, instance: this.br });\r\n    callSearchResultsCallback(await $.ajax({\r\n      url: url,\r\n      cache: true,\r\n      xhrFields: {\r\n        withCredentials: this.br.protected,\r\n      },\r\n      beforeSend: xhr => { this.searchXHR = xhr; },\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * cancels AJAX Call\r\n   * emits custom event\r\n   */\r\n  _cancelSearch() {\r\n    this.searchXHR?.abort();\r\n    this.searchView.clearSearchFieldAndResults(false);\r\n    this.searchTerm = '';\r\n    this.searchXHR = null;\r\n    this.searchCancelled = true;\r\n    this.searchResults = null;\r\n  }\r\n\r\n  /**\r\n   * External function to cancel search\r\n   * checks for term & xhr in flight before running\r\n   */\r\n  cancelSearchRequest() {\r\n    this.searchCancelled = true;\r\n    if (this.searchXHR !== null) {\r\n      this._cancelSearch();\r\n      this.searchView.toggleSearchPending();\r\n      this.br.trigger('SearchCanceled', { term: this.searchTerm, instance: this.br });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search Results return handler\r\n   * @param {SearchInsideResults} results\r\n   * @param {object} options\r\n   * @param {boolean} options.goToFirstResult\r\n   */\r\n  BRSearchCallback(results, options) {\r\n    marshallSearchResults(\r\n      results,\r\n      pageNum => this.br.book.getPageNum(this.br.book.leafNumToIndex(pageNum)),\r\n      this.options.preTag,\r\n      this.options.postTag,\r\n    );\r\n    this.searchResults = results || null;\r\n\r\n    this.updateSearchHilites();\r\n    this.br.removeProgressPopup();\r\n    if (options.goToFirstResult) {\r\n      this.jumpToMatch(0);\r\n    }\r\n    this.br.trigger('SearchCallback', { results, options, instance: this.br });\r\n  }\r\n\r\n  /**\r\n   * Main search results error handler\r\n   * @param {SearchInsideResults} results\r\n   */\r\n  BRSearchCallbackError(results) {\r\n    this._BRSearchCallbackError(results);\r\n  }\r\n\r\n  /**\r\n   * @private draws search results error\r\n   * @param {SearchInsideResults} results\r\n   */\r\n  _BRSearchCallbackError(results) {\r\n    this.searchResults = results;\r\n    const payload = {\r\n      term: this.searchTerm,\r\n      results,\r\n      instance: this.br,\r\n    };\r\n    if (results.error) {\r\n      this.br.trigger('SearchCallbackError', payload);\r\n    } else if (0 == results.matches.length) {\r\n      if (false === results.indexed) {\r\n        this.br.trigger('SearchCallbackBookNotIndexed', payload);\r\n        return;\r\n      }\r\n      this.br.trigger('SearchCallbackEmpty', payload);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * updates search on-page highlights controller\r\n   */\r\n  updateSearchHilites() {\r\n    /** @type {SearchInsideMatch[]} */\r\n    const matches = this.searchResults?.matches || [];\r\n    /** @type { {[pageIndex: number]: SearchInsideMatchBox[]} } */\r\n    const boxesByIndex = {};\r\n\r\n    // Clear any existing svg layers\r\n    this.removeSearchHilites();\r\n\r\n    // Group by pageIndex\r\n    for (const match of matches) {\r\n      for (const box of match.par[0].boxes) {\r\n        const pageIndex = this.br.book.leafNumToIndex(box.page);\r\n        const pageBoxes = boxesByIndex[pageIndex] || (boxesByIndex[pageIndex] = []);\r\n        pageBoxes.push(box);\r\n      }\r\n    }\r\n\r\n    // update any already created pages\r\n    for (const [pageIndexString, boxes] of Object.entries(boxesByIndex)) {\r\n      const pageIndex = parseFloat(pageIndexString);\r\n      const page = this.br.book.getPage(pageIndex);\r\n      const pageContainers = this.br.getActivePageContainerElementsForIndex(pageIndex);\r\n      for (const container of pageContainers) {\r\n        renderBoxesInPageContainerLayer('searchHiliteLayer', boxes, page, container, boxes.map(b => `match-index-${b.matchIndex}`));\r\n      }\r\n    }\r\n\r\n    this._searchBoxesByIndex = boxesByIndex;\r\n  }\r\n\r\n  /**\r\n   * remove search highlights\r\n   */\r\n  removeSearchHilites() {\r\n    $(this.br.getActivePageContainerElements()).find('.searchHiliteLayer').remove();\r\n  }\r\n\r\n  /**\r\n   * Goes to the page specified. If the page is not viewable, tries to load the page\r\n   * FIXME Most of this logic is IA specific, and should be less integrated into here\r\n   * or at least more configurable.\r\n   * @param {number} matchIndex\r\n   */\r\n  async jumpToMatch(matchIndex) {\r\n    const match = this.searchResults?.matches[matchIndex];\r\n    const book = this.br.book;\r\n    const pageIndex = book.leafNumToIndex(match.par[0].page);\r\n    const page = book.getPage(pageIndex);\r\n    const onNearbyPage = Math.abs(this.br.currentIndex() - pageIndex) < 3;\r\n    let makeUnviewableAtEnd = false;\r\n    if (!page.isViewable) {\r\n      const resp = await fetch('/services/bookreader/request_page?' + new URLSearchParams({\r\n        id: this.br.options.bookId,\r\n        subprefix: this.br.options.subPrefix,\r\n        leafNum: page.leafNum,\r\n      })).then(r => r.json());\r\n\r\n      for (const leafNum of resp.value) {\r\n        book.getPage(book.leafNumToIndex(leafNum)).makeViewable();\r\n      }\r\n\r\n      // not able to show page; make the page viewable anyways so that it can\r\n      // actually open. On IA, it has a fallback to a special error page.\r\n      if (!resp.value.length) {\r\n        book.getPage(pageIndex).makeViewable();\r\n        makeUnviewableAtEnd = true;\r\n      }\r\n\r\n      // Trigger an update of book\r\n      this.br._modes.mode1Up.mode1UpLit.updatePages();\r\n      if (this.br.activeMode == this.br._modes.mode1Up) {\r\n        await this.br._modes.mode1Up.mode1UpLit.updateComplete;\r\n      }\r\n    }\r\n    /* this updates the URL */\r\n    if (!this.br._isIndexDisplayed(pageIndex)) {\r\n      this.suppressFragmentChange = false;\r\n      this.br.jumpToIndex(pageIndex);\r\n    }\r\n\r\n    // Reset it to unviewable if it wasn't resolved\r\n    if (makeUnviewableAtEnd) {\r\n      book.getPage(pageIndex).makeViewable(false);\r\n    }\r\n\r\n    // Scroll/flash in the ui\r\n    const $boxes = await poll(() => $(`rect.match-index-${match.matchIndex}`), { until: result => result.length > 0 });\r\n    if ($boxes.length) {\r\n      $boxes.css('animation', 'none');\r\n      $boxes[0].scrollIntoView({\r\n        // Only vertically center the highlight if we're in 1up or in full screen. In\r\n        // 2up, if we're not fullscreen, the whole body gets scrolled around to try to\r\n        // center the highlight ðŸ™„ See:\r\n        // https://stackoverflow.com/questions/11039885/scrollintoview-causing-the-whole-page-to-move/11041376\r\n        // Note: nearest doesn't quite work great, because the ReadAloud toolbar is now\r\n        // full-width, and covers up the last line of the highlight.\r\n        block: this.br.constMode1up == this.br.mode || this.br.isFullscreenActive ? 'center' : 'nearest',\r\n        inline: 'center',\r\n        behavior: onNearbyPage ? 'smooth' : 'auto',\r\n      });\r\n      // wait for animation to start\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n      $boxes.removeAttr(\"style\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all search pins\r\n   */\r\n  removeSearchResults(suppressFragmentChange = false) {\r\n    this.removeSearchHilites(); //be sure to set all box.divs to null\r\n    this.searchTerm = null;\r\n    this.searchResults = null;\r\n    if (!suppressFragmentChange) {\r\n      this.br.trigger(BookReader.eventNames.fragmentChange);\r\n    }\r\n  }\r\n}\r\nBookReader?.registerPlugin('search', SearchPlugin);\r\n\r\n/**\r\n * @typedef {object} SearchOptions\r\n * @property {boolean} goToFirstResult\r\n * @property {boolean} disablePopup\r\n * @property {boolean} suppressFragmentChange\r\n * @property {(null|function)} error (deprecated)\r\n * @property {(null|function)} success (deprecated)\r\n */\r\n\r\n/**\r\n * @typedef {object} SearchInsideMatchBox\r\n * @property {number} page\r\n * @property {number} r\r\n * @property {number} l\r\n * @property {number} b\r\n * @property {number} t\r\n * @property {HTMLDivElement} [div]\r\n * @property {number} matchIndex This is a fake field! not part of the API response. The index of the match that contains this box in total search results matches.\r\n */\r\n\r\n/**\r\n * @typedef {object} SearchInsideMatch\r\n * @property {number} matchIndex This is a fake field! Not part of the API response. It is added by the JS.\r\n * @property {string} displayPageNumber (fake field) The page number as it should be displayed in the UI.\r\n * @property {string} html (computed field) The html-escaped raw html to display in the UI.\r\n * @property {string} text\r\n * @property {Array<{ page: number, boxes: SearchInsideMatchBox[] }>} par\r\n */\r\n\r\n/**\r\n * @typedef {object} SearchInsideResults\r\n * @property {string} q\r\n * @property {string} error\r\n * @property {SearchInsideMatch[]} matches\r\n * @property {boolean} indexed\r\n */\r\n","/**\r\n * @typedef {String} StringWithVars\r\n * A template string with {{foo}} style variables\r\n * Also supports filters, like {{bookPath|urlencode}} (See APPLY_FILTERS for the\r\n * supported list of filters)\r\n **/\r\n\r\n/**\r\n * @param {StringWithVars|String} template\r\n * @param { {[varName: string]: { toString: () => string} } } vars\r\n * @param { {[varName: string]: { toString: () => string} } } [overrides]\r\n * @returns {StringWithVars|string}\r\n */\r\nexport function applyVariables(template, vars, overrides = {}, possibleFilters = APPLY_FILTERS) {\r\n  return template?.replace(/\\{\\{([^}]*?)\\}\\}/g, ($0, $1) => {\r\n    if (!$1) return $0;\r\n    /** @type {string} */\r\n    const expression = $1;\r\n    const [varName, ...filterNames] = expression.split('|').map(x => x.trim());\r\n    const defined = varName in overrides || varName in vars;\r\n\r\n    // If it's not defined, don't expand it at all\r\n    if (!defined) return $0;\r\n\r\n    const value = varName in overrides ? overrides[varName]\r\n      : varName in vars ? vars[varName] : null;\r\n    const filters = filterNames.map(n => possibleFilters[n]);\r\n    return filters.reduce((acc, cur) => cur(acc), value && value.toString());\r\n  });\r\n}\r\n\r\n/** @type { {[filterName: String]:( string => string)} } */\r\nexport const APPLY_FILTERS = {\r\n  urlencode: encodeURIComponent,\r\n};\r\n"],"names":["PROPER_FUNCTION_NAME","fails","whitespaces","module","exports","METHOD_NAME","name","$","$trim","target","proto","forced","forcedStringTrimMethod","trim","this","BookReaderPlugin","br","_classCallCheck","options","key","value","Object","assign","pageContainer","$toolbarElement","$navBar","SearchView","_ref","_ref$searchCancelledC","searchCancelledCallback","matches","cacheDOMElements","cancelSearch","bindEvents","dom","toolbarSearch","buildToolbarSearch","query","val","remove","dispatchEventWhenComplete","arguments","length","undefined","plugins","search","removeSearchResults","removeResultPins","emptyMatches","setQuery","teardownSearchNavigation","trigger","selector","before","concat","resultsPosition","searchNavigation","positionMessage","currentMatchIndex","namespace","on","clearSearchFieldAndResults","bind","showPrevResult","showNextResult","toggleSidebar","mode","constModeThumb","switchMode","constMode1up","getClosestMatchIndex","start","end","comparator","eq","click","updateResultsPosition","updateSearchNavigationButtons","comparisonFn","matchPages","map","m","par","page","currentPage","currentIndex","closestTo","pool","slice","closestPage","indexOf","find","text","attr","off","resize","matchingSearchResult","constMode2up","find2upMatchingSearchResult","find1upMatchingSearchResult","_this","_this2","_isIndexDisplayed","setCurrentMatchIndex","bool","pinsVisibleState","refs","$BRfooter","css","visibility","document","createElement","classList","add","innerHTML","imagesBaseURL","_this3","forEach","match","pageIndex","book","leafNumToIndex","percentThrough","constructor","util","cssPercentage","getNumLeafs","html","Math","max","substring","replace","addClass","left","append","displayPageNumber","appendTo","event","marker","currentTarget","tooltip","querySelector","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","x","style","setProperty","removeClass","jumpToMatch","matchIndex","_this4","showProgressPopup","progressPopupClosed","removeProgressPopup","toggleSearchPending","errorDetails","renderModalMessage","delayModalRemovalFor","messageHTML","modal","el","timeoutMS","setTimeout","e","preventDefault","_ref2","_this5","results","renderSearchNavigation","bindSearchNavigationEvents","renderPins","goToFirstResult","one","removeSearchHilites","searchTerm","_event$detail","isIndexed","detail","props","indexed","renderErrorModal","renderBookNotIndexedModal","renderResultsEmptyModal","window","addEventListener","handleSearchCallbackError","handleSearchCallback","handleSearchStarted","handleSearchCallbackBookNotIndexed","handleSearchCallbackEmpty","updateSearchNavigation","submitHandler","renderMatch","preTag","postTag","preTagRe","escapeRegExp","escapeHTML","postTagRe","regex","RegExp","_regeneratorRuntime","t","r","prototype","n","hasOwnProperty","o","defineProperty","i","Symbol","a","iterator","c","asyncIterator","u","toStringTag","define","enumerable","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","type","arg","call","h","l","f","s","y","GeneratorFunction","GeneratorFunctionPrototype","p","d","getPrototypeOf","v","values","g","defineIteratorMethods","_invoke","AsyncIterator","invoke","_typeof","resolve","__await","then","callInvokeWithMethodAndArg","Error","done","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","return","TypeError","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","isNaN","displayName","isGeneratorFunction","mark","setPrototypeOf","__proto__","awrap","async","Promise","keys","reverse","pop","prev","charAt","stop","rval","handle","complete","finish","catch","delegateYield","asyncGeneratorStep","_asyncToGenerator","apply","_next","_throw","_defineProperties","_toPropertyKey","_callSuper","_getPrototypeOf","ReferenceError","_assertThisInitialized","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","Boolean","valueOf","_superPropGet","_get","get","_superPropBase","getOwnPropertyDescriptor","_setPrototypeOf","toPrimitive","String","_toPrimitive","BookReader","SearchPlugin","_BookReaderPlugin","_len","args","Array","_key","enabled","searchInsideUrl","join","initialSearchTerm","_inherits","searchResults","searchXHR","_searchBoxesByIndex","searchView","_cancelSearch","term","instance","init","suppressFragmentChange","after","index","boxes","renderBoxesInPageContainerLayer","$container","b","_search","_callee","overrides","defaultOptions","url","callSearchResultsCallback","_args","_context","disablePopup","error","success","jQuery","extend","searchCancelled","eventNames","fragmentChange","applyVariables","vars","searchInsideResults","responseHasError","hasCustomError","hasCustomSuccess","console","BRSearchCallbackError","BRSearchCallback","t0","ajax","cache","xhrFields","withCredentials","protected","beforeSend","xhr","t1","_this$searchXHR","abort","displayPageNumberFn","_step","pageNum","_iterator","_createForOfIteratorHelper","entries","_step$value","_slicedToArray","getPageNum","_step2","_iterator2","_step3","_iterator3","err","marshallSearchResults","updateSearchHilites","_BRSearchCallbackError","payload","_this$searchResults","boxesByIndex","box","_i","_Object$entries","_Object$entries$_i","pageIndexString","parseFloat","getPage","getActivePageContainerElementsForIndex","container","getActivePageContainerElements","_jumpToMatch","_callee2","_this$searchResults2","onNearbyPage","makeUnviewableAtEnd","resp","_iterator4","_step4","leafNum","$boxes","_context2","abs","isViewable","fetch","URLSearchParams","id","bookId","subprefix","subPrefix","json","makeViewable","_modes","mode1Up","mode1UpLit","updatePages","activeMode","updateComplete","jumpToIndex","poll","until","result","scrollIntoView","block","isFullscreenActive","inline","behavior","removeAttr","_x","registerPlugin","template","possibleFilters","APPLY_FILTERS","$0","$1","_expression$split$map2","split","varName","filterNames","reduce","acc","cur","toString","urlencode","encodeURIComponent"],"sourceRoot":""}