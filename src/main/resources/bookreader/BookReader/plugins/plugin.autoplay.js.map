{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/BookReaderPlugin.js","webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["// @ts-check\r\n/** @typedef {import(\"./BookReader.js\").default} BookReader */\r\n\r\n/**\r\n * @template TOptions\r\n */\r\nexport class BookReaderPlugin {\r\n  /**\r\n   * @param {BookReader} br\r\n   */\r\n  constructor(br) {\r\n    /** @type {BookReader} */\r\n    this.br = br;\r\n    /** @type {TOptions} */\r\n    this.options;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {TOptions} options\r\n   **/\r\n  setup(options) {\r\n    this.options = Object.assign({}, this.options, options);\r\n  }\r\n\r\n  /** @abstract */\r\n  init() {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {import (\"./BookReader/PageContainer.js\").PageContainer} pageContainer\r\n   */\r\n  _configurePageContainer(pageContainer) {\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {JQuery<HTMLElement>} $toolbarElement\r\n   */\r\n  _configureToolbar($toolbarElement) {\r\n  }\r\n\r\n  /** @abstract @protected */\r\n  _bindNavigationHandlers() {}\r\n\r\n  /**\r\n   * @param {JQuery<HTMLElement>} $navBar\r\n   */\r\n  extendNavBar($navBar) {}\r\n}\r\n","// @ts-check\r\nimport { EVENTS } from \"../BookReader/events.js\";\r\nimport { parseAnimationSpeed } from \"../BookReader/utils.js\";\r\nimport { BookReaderPlugin } from \"../BookReaderPlugin.js\";\r\n\r\n/**\r\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\r\n */\r\nexport class AutoplayPlugin extends BookReaderPlugin {\r\n  options = {\r\n    enabled: true,\r\n    /**\r\n     * @type {number | 'fast' | 'slow'}\r\n     * How quickly the flip animation should run.\r\n     **/\r\n    flipSpeed: 1500,\r\n    /** How long to pause on each page between flips */\r\n    flipDelay: 5000,\r\n    /** Allow controlling the autoflip/speed/delay from the url */\r\n    urlParams: true,\r\n  }\r\n\r\n  timer = null;\r\n\r\n  /** @override */\r\n  init() {\r\n    if (!this.options.enabled) return;\r\n\r\n    this.br.bind(EVENTS.stop, () => this.stop());\r\n\r\n    if (this.options.urlParams) {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      if (urlParams.get('flipSpeed')) {\r\n        this.options.flipSpeed = parseAnimationSpeed(urlParams.get('flipSpeed')) || this.options.flipSpeed;\r\n      }\r\n      if (urlParams.get('flipDelay')) {\r\n        this.options.flipDelay = parseAnimationSpeed(urlParams.get('flipDelay')) || this.options.flipDelay;\r\n      }\r\n      if (urlParams.get('autoflip') === '1') {\r\n        this.toggle();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** @override */\r\n  _bindNavigationHandlers() {\r\n    if (!this.options.enabled) return;\r\n\r\n    const jIcons = this.br.$('.BRicon');\r\n\r\n    jIcons.filter('.play').on('click', () => {\r\n      this.toggle();\r\n      return false;\r\n    });\r\n\r\n    jIcons.filter('.pause').on('click', () => {\r\n      this.toggle();\r\n      return false;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Starts autoplay mode\r\n   * @param {object} overrides\r\n   * @param {number} overrides.flipSpeed\r\n   * @param {number} overrides.flipDelay\r\n   */\r\n  toggle(overrides = null) {\r\n    if (!this.options.enabled) return;\r\n\r\n    Object.assign(this.options, overrides);\r\n    this.br.trigger(EVENTS.stop);\r\n\r\n    let bComingFrom1up = false;\r\n    if (this.br.constMode2up != this.br.mode) {\r\n      bComingFrom1up = true;\r\n      this.br.switchMode(this.br.constMode2up);\r\n    }\r\n\r\n    if (null == this.timer) {\r\n      // $$$ Draw events currently cause layout problems when they occur during animation.\r\n      //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\r\n      //     we workaround for now by not triggering immediate animation in that case.\r\n      //     See https://bugs.launchpad.net/gnubook/+bug/328327\r\n      if (('rl' == this.br.pageProgression) && bComingFrom1up) {\r\n        // don't flip immediately -- wait until timer fires\r\n      } else {\r\n        // flip immediately\r\n        this.br.next({ triggerStop: false, flipSpeed: this.options.flipSpeed });\r\n      }\r\n\r\n      this.br.$('.play').hide();\r\n      this.br.$('.pause').show();\r\n      this.timer = setInterval(() => {\r\n        if (this.br.animating) return;\r\n\r\n        if (Math.max(this.br.twoPage.currentIndexL, this.br.twoPage.currentIndexR) >= this.br.book.getNumLeafs() - 1) {\r\n          this.br.prev({ triggerStop: false, flipSpeed: this.options.flipSpeed }); // $$$ really what we want?\r\n        } else {\r\n          this.br.next({ triggerStop: false, flipSpeed: this.options.flipSpeed });\r\n        }\r\n      }, parseAnimationSpeed(this.options.flipDelay));\r\n    } else {\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop autoplay mode, allowing animations to finish\r\n   */\r\n  stop() {\r\n    if (!this.options.enabled) return;\r\n\r\n    if (null != this.timer) {\r\n      clearInterval(this.timer);\r\n      this.br.$('.pause').hide();\r\n      this.br.$('.play').show();\r\n      this.timer = null;\r\n    }\r\n  }\r\n}\r\n\r\nconst BookReader = /** @type {typeof import('../BookReader').default} */(window.BookReader);\r\nBookReader?.registerPlugin('autoplay', AutoplayPlugin);\r\n"],"names":["BookReaderPlugin","br","_classCallCheck","this","options","key","value","Object","assign","pageContainer","$toolbarElement","$navBar","AutoplayPlugin","_BookReaderPlugin","_this","_len","arguments","length","args","Array","_key","_defineProperty","_callSuper","concat","enabled","flipSpeed","flipDelay","urlParams","_inherits","_this2","bind","EVENTS","stop","URLSearchParams","window","location","search","get","parseAnimationSpeed","toggle","_this3","jIcons","$","filter","on","_this4","overrides","undefined","trigger","bComingFrom1up","constMode2up","mode","switchMode","timer","pageProgression","next","triggerStop","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","book","getNumLeafs","prev","clearInterval","BookReader","registerPlugin"],"sourceRoot":""}